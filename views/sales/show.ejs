<%- include('../layouts/header', { title: 'Venta #' + sale.id + ' - POS Dulces', activeTab: 'pos' }) %>

    <div class="container">
        <div class="page-header">
            <h2>üßæ Detalles de Venta #<%= sale.id %></h2>
            <a href="/sales/history" class="btn btn-secondary">‚Üê Volver al Historial</a>
        </div>

        <div class="sale-details">
            <div class="card">
                <div class="card-header">
                    <h3>Informaci√≥n de la Venta</h3>
                </div>
                <div class="card-body">
                    <div class="detail-row">
                        <span class="label">Fecha:</span>
                        <span class="value"><%= new Date(sale.created_at).toLocaleString('es-PE') %></span>
                    </div>
                    <div class="detail-row">
                        <span class="label">Vendedor:</span>
                        <span class="value">üë§ <%= sale.username %></span>
                    </div>
                    <div class="detail-row">
                        <span class="label">M√©todo de Pago:</span>
                        <span class="value">
                            <%= sale.payment_method === 'efectivo' ? 'üíµ Efectivo' : 'üí≥ Tarjeta' %>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="label">Monto Recibido:</span>
                        <span class="value">S/ <%= parseFloat(sale.received_amount).toFixed(2) %></span>
                    </div>
                    <% if (sale.change_amount > 0) { %>
                        <div class="detail-row">
                            <span class="label">Vuelto:</span>
                            <span class="value">S/ <%= parseFloat(sale.change_amount).toFixed(2) %></span>
                        </div>
                    <% } %>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Productos</h3>
                </div>
                <div class="card-body">
                    <div class="sale-items">
                        <% items.forEach(item => { %>
                            <div class="sale-item-detail">
                                <div class="item-info">
                                    <div class="item-name"><%= item.name %></div>
                                    <div class="item-details">
                                        <%= item.quantity %> x S/ <%= parseFloat(item.price).toFixed(2) %>
                                    </div>
                                </div>
                                <div class="item-total">
                                    S/ <%= parseFloat(item.price * item.quantity).toFixed(2) %>
                                </div>
                            </div>
                        <% }) %>
                        
                        <div class="sale-total-row">
                            <span class="total-label">TOTAL:</span>
                            <span class="total-amount">S/ <%= parseFloat(sale.total).toFixed(2) %></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button onclick="window.print()" class="btn btn-primary">üñ®Ô∏è Imprimir</button>
                <a href="/sales" class="btn btn-secondary">Nueva Venta</a>
            </div>
        </div>
    </div>

    <%- include('../layouts/footer') %>