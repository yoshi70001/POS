<%- include('../layouts/header', { title: 'Usuarios - POS Dulces', activeTab: 'users' }) %>

    <div class="container">
        <div class="page-header">
            <h2>ğŸ‘¥ GestiÃ³n de Usuarios</h2>
            <a href="/users/new" class="btn btn-primary">+ Nuevo Usuario</a>
        </div>

        <% if (users.length > 0) { %>
            <div class="users-list">
                <% users.forEach(user => { %>
                    <div class="user-item">
                        <div class="user-info">
                            <div class="user-avatar">
                                <%= user.role === 'admin' ? 'ğŸ‘‘' : 'ğŸ‘¤' %>
                            </div>
                            <div class="user-details">
                                <h3 class="user-name">
                                    <%= user.username %>
                                    <%= user.id === currentUser.id ? '<span class="badge-you">(TÃº)</span>' : '' %>
                                </h3>
                                <div class="user-role">
                                    <%= user.role === 'admin' ? 'ğŸ›¡ï¸ Administrador' : 'ğŸ’¼ Vendedor' %>
                                </div>
                                <div class="user-date">
                                    Creado: <%= new Date(user.created_at).toLocaleDateString('es-PE') %>
                                </div>
                            </div>
                        </div>
                        <div class="user-actions">
                            <a href="/users/<%= user.id %>" class="btn-icon" title="Ver">ğŸ‘ï¸</a>
                            <a href="/users/<%= user.id %>/edit" class="btn-icon" title="Editar">âœï¸</a>
                            <a href="/users/<%= user.id %>/change-password" class="btn-icon" title="Cambiar ContraseÃ±a">ğŸ”‘</a>
                            <% if (user.id !== currentUser.id) { %>
                                <button onclick="deleteUser(<%= user.id %>, '<%= user.username %>')" 
                                        class="btn-icon btn-danger" title="Eliminar">ğŸ—‘ï¸</button>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-state">
                <div class="empty-icon">ğŸ‘¥</div>
                <h3>No hay usuarios registrados</h3>
                <p>Crea el primer usuario para comenzar</p>
                <a href="/users/new" class="btn btn-primary">Crear Usuario</a>
            </div>
        <% } %>
    </div>

    <script>
        async function deleteUser(userId, username) {
            if (!confirm(`Â¿EstÃ¡s seguro de que deseas eliminar al usuario "${username}"?\n\nEsta acciÃ³n no se puede deshacer.`)) {
                return;
            }

            try {
                const response = await fetch('/users/' + userId, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    alert('Usuario eliminado exitosamente');
                    window.location.reload();
                } else {
                    const data = await response.json();
                    alert('Error al eliminar: ' + (data.error || 'Error desconocido'));
                }
            } catch (error) {
                alert('Error al eliminar el usuario');
            }
        }
    </script>

    <%- include('../layouts/footer') %>